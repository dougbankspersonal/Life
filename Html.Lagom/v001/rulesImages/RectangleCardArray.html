<html>
  <head>
    <link rel="stylesheet" href="../../css/rectangle_card_array.css" />
    <link rel="stylesheet" href="../../css/rectangle_cards.css" />
    <link rel="stylesheet" href="../../css/lagom_images.css" />
    <link rel="stylesheet" href="../../SharedWebBoardGame/css/card.css" />
    <link rel="stylesheet" href="../../SharedWebBoardGame/css/main.css" />
    <link rel="stylesheet" href="../../SharedWebBoardGame/css/image.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
    <style type="text/css"></style>
  </head>

  <body id="body">
    <!-- configure Dojo -->
    <script>
      // Instead of using data-dojo-config, we're creating a dojoConfig
      // object *before* we load dojo.js; they're functionally identical,
      // it's just easier to read this approach with a larger configuration.
      var dojoConfig = {
        baseUrl: "../..",
        async: true,
        // This code registers the correct location of the "demo"
        // package so we can load Dojo from the CDN whilst still
        // being able to load local modules
        packages: [
          { name: "dojo", location: "../../bower_components/dojo" },
          { name: "javascript", location: "javascript" },
          {
            name: "sharedJavascript",
            location: "SharedWebBoardgame/javascript",
          },
        ],
      };
    </script>
    <!-- load Dojo -->
    <script src="../../../../bower_components/dojo/dojo.js"></script>

    <script>
      require([
        "dojo/dom",
        "dojo/dom-style",
        "sharedJavascript/cards",
        "sharedJavascript/debugLog",
        "sharedJavascript/genericMeasurements",
        "sharedJavascript/genericUtils",
        "sharedJavascript/htmlUtils",
        "sharedJavascript/systemConfigs",
        "javascript/rectangleCards",
        "javascript/rectangleCardData",
      ], function (
        dom,
        domStyle,
        cards,
        debugLogModule,
        genericMeasurements,
        genericUtils,
        htmlUtils,
        systemConfigs,
        rectangleCards,
        rectangleCardData
      ) {
        var debugLog = debugLogModule.debugLog;

        var cardWiggleDeg = 3;

        const seededZeroToOneRandomFunction =
          genericUtils.createSeededGetZeroToOneRandomFunction(346534);

        function modifyCardLayout(card, cardDesc, isLastCard) {
          var rotDeg = cardDesc.orientation * 90;
          rotDeg += genericUtils.getRandomIntInRange(
            -cardWiggleDeg,
            cardWiggleDeg,
            seededZeroToOneRandomFunction
          );

          var marginRight;
          var marginLeft;
          if (isLastCard) {
            // Last card in the row, no margin.
            marginRight = "0px";
          } else if (cardDesc.orientation === 0 || cardDesc.orientation === 2) {
            marginRight = `${-cardWidthSpacing}px`;
            marginLeft = "0px";
          } else {
            marginRight = `${-cardHeightSpacing + heightWidthDiff / 2}px`;
            marginLeft = `${heightWidthDiff / 2}px`;
          }

          domStyle.set(card, {
            zIndex: `${100 + i}`,
            transform: `rotate(${rotDeg}deg)`,
            "margin-right": marginRight,
            "margin-left": marginLeft,
          });
        }

        var setupCardDescArray = [
          {
            index: 2,
            orientation: 3,
          },
          {
            index: 30,
            orientation: 3,
          },
          {
            index: 59,
            orientation: 3,
          },
          {
            index: 13,
            orientation: 2,
          },
          {
            index: 25,
            orientation: 2,
          },
        ];

        systemConfigs.setSystemConfigs({
          pageless: true,
        });
        rectangleCardData.generateCardConfigs();

        var cardWidthSpacing = genericMeasurements.standardCardWidthPx * 0.5;
        var cardHeightSpacing = genericMeasurements.standardCardHeightPx * 0.5;
        var heightWidthDiff =
          genericMeasurements.standardCardHeightPx -
          genericMeasurements.standardCardWidthPx;

        var bodyNode = dom.byId("body");
        var pageOfItemsContentsNode = htmlUtils.addPageOfItems(bodyNode, [
          "card_array",
        ]);

        domStyle.set(pageOfItemsContentsNode, {
          padding: "20px",
        });

        var cardDescArray = setupCardDescArray;

        debugLog("Cards", "cardDescArray.length = ", cardDescArray.length);

        for (var i = 0; i < cardDescArray.length; i++) {
          var cardDesc = cardDescArray[i];
          var card;
          if (cardDesc.facedown) {
            card = rectangleCards.addCardBack(pageOfItemsContentsNode, i);
          } else {
            card = rectangleCards.addCardFront(
              pageOfItemsContentsNode,
              cardDesc.index
            );
          }
          // Twiddle card layout.
          modifyCardLayout(card, cardDesc, i == cardDescArray.length - 1);
        }
      });
    </script>
  </body>
</html>
